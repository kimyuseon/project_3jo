{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/my_django.css' %}">
    <title>재료 선택</title>
    <style>
        /* 1. 이 페이지 전용 그리드 및 카드 스타일 (공통 CSS를 덮어쓰지 않음) */
        .fridge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            gap: 12px;
            padding: 10px 0;
        }

        .fridge-card {
            background: white;
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
            position: relative;
        }

        /* 2. 카테고리 탭 스타일 */
        .category-scroll-wrapper {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding: 15px 0;
            gap: 10px;
            -ms-overflow-style: none; scrollbar-width: none;
            margin-bottom: 15px;
        }
        .category-scroll-wrapper::-webkit-scrollbar { display: none; }
        
        .category-tab {
            padding: 10px 18px;
            background: #eee;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            color: #666;
            font-weight: 600;
        }
        .category-tab.active {
            background: #ff6b6b;
            color: white;
        }
        
        .ingredient-panel { display: none; }
        .ingredient-panel.show { display: block; }

        /* 3. 수량 조절기 스타일 */
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 20px;
            margin: 10px auto;
            width: fit-content;
            padding: 2px 10px;
        }
        .qty-btn {
            background: none; border: none; color: #ff6b6b;
            font-size: 20px; font-weight: bold; cursor: pointer; padding: 0 10px;
        }
        .qty-number { font-size: 15px; font-weight: bold; min-width: 25px; text-align: center; }
        
        /* 4. 추가 버튼 스타일 */
        .submit-add-btn {
            background: #ff6b6b; color: white; border: none; border-radius: 12px;
            padding: 10px; font-size: 13px; cursor: pointer; width: 95%;
            font-weight: bold; box-shadow: 0 2px 5px rgba(255,107,107,0.3);
        }

        .ingredient-img {
            width: 45px; height: 45px; object-fit: contain;
        }
    </style>
</head>
<body class="select-page">
    <div class="container">
        <header style="display: flex; align-items: center; padding-bottom: 15px; border-bottom: 1px solid #eee; margin-bottom: 10px;">
            <a href="{% url 'my_django:fridge_main' %}" style="font-size: 24px; text-decoration: none; color: #333; padding: 5px;">✕</a>
            <h2 style="margin-left: 10px; font-size: 20px;">재료 추가하기</h2>
        </header>

        <div class="category-scroll-wrapper">
            {% for category in organized_data.keys %}
                <div class="category-tab {% if forloop.first %}active{% endif %}" 
                     onclick="openTab(event, 'tab-{{ forloop.counter }}')">
                    {{ category }}
                </div>
            {% endfor %}
        </div>

        <div class="ingredient-content">
            {% for category, items in organized_data.items %}
                <div id="tab-{{ forloop.counter }}" class="ingredient-panel {% if forloop.first %}show{% endif %}">
                    <div class="fridge-grid"> {% for item in items %}
                            <div class="fridge-card"> <form action="{% url 'my_django:add_ingredient' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="name" value="{{ item.name }}">
                                    <input type="hidden" name="category" value="{{ category }}">
                                    
                                    <div style="height: 50px; display: flex; align-items: center; justify-content: center;">
                                        <img src="{% static 'images/' %}{{ item.name }}.png" 
                                             alt="{{ item.name }}" 
                                             class="ingredient-img"
                                             onerror="this.src='{% static 'images/default.png' %}'">
                                    </div>
                                    
                                    <span style="display: block; margin: 10px 0; font-size: 15px; font-weight: 600;">
                                        {{ item.name }}
                                    </span>

                                    <div class="quantity-selector">
                                        <button type="button" class="qty-btn" onclick="adjustQty(this, -1)">-</button>
                                        <input type="hidden" name="quantity" value="1" class="qty-input">
                                        <span class="qty-number">1</span>
                                        <button type="button" class="qty-btn" onclick="adjustQty(this, 1)">+</button>
                                    </div>
                                    
                                    <button type="submit" class="submit-add-btn">추가하기</button>
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function openTab(evt, tabId) {
            const panels = document.querySelectorAll('.ingredient-panel');
            const tabs = document.querySelectorAll('.category-tab');
            panels.forEach(p => p.classList.remove('show'));
            tabs.forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('show');
            evt.currentTarget.classList.add('active');
        }

        function adjustQty(btn, change) {
            const container = btn.parentElement;
            const input = container.querySelector('.qty-input');
            const display = container.querySelector('.qty-number');
            let currentVal = parseInt(input.value);
            let newVal = currentVal + change;
            if (newVal < 1) newVal = 1; 
            input.value = newVal;
            display.innerText = newVal;
        }
    </script>
</body>
</html>