{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/my_django.css' %}">
    <title>재료 선택</title>
</head>
<body class="select-page">
    <div class="container">
        <header class="select-header" style="display: flex; align-items: center; padding-bottom: 10px; border-bottom: 1px solid #eee;">
            <a href="{% url 'my_django:fridge_main' %}" class="close-btn" style="font-size: 24px; text-decoration: none; color: #333;">✕</a>
            <h2 style="margin-left: 15px; font-size: 18px;">재료 선택</h2>
        </header>

        <div class="category-scroll-wrapper">
            {% for category in sample_data.keys %}
                <div class="category-tab {% if forloop.first %}active{% endif %}" 
                     onclick="openTab(event, 'tab-{{ forloop.counter }}')">
                    {{ category }}
                </div>
            {% endfor %}
        </div>

        <div class="ingredient-content">
            {% for category, items in sample_data.items %}
                <div id="tab-{{ forloop.counter }}" class="ingredient-panel {% if forloop.first %}show{% endif %}">
                    <div class="ingredient-grid">
                        {% for item in items %}
                            <div class="card"> 
                                <form action="{% url 'my_django:add_ingredient' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="name" value="{{ item }}">
                                    <input type="hidden" name="category" value="{{ category }}">
                                    
                                    <div class="image-box" style="height: 50px; display: flex; align-items: center; justify-content: center;">
                                        <img src="{% static 'images/' %}{{ item }}.png" 
                                             alt="{{ item }}" 
                                             style="width: 45px; height: 45px; object-fit: contain;">
                                    </div>
                                    <span class="ingredient-name" style="display: block; margin: 5px 0; font-size: 14px; font-weight: bold;">{{ item }}</span>
                                    
                                    <div class="input-group" style="margin-bottom: 10px;">
                                        <input type="number" name="quantity" value="1" min="1" 
                                               style="width: 40px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;">
                                        <span style="font-size: 11px;">개</span>
                                    </div>
                                    
                                    <input type="date" name="expiry_date" 
                                           style="width: 90%; font-size: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px;">

                                    <button type="submit" class="add-badge" 
                                            style="background: #ff6b6b; color: white; border: none; border-radius: 20px; width: 80%; height: 25px; cursor: pointer; font-size: 12px;">
                                        추가 +
                                    </button>
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function openTab(evt, tabId) {
            const panels = document.querySelectorAll('.ingredient-panel');
            const tabs = document.querySelectorAll('.category-tab');
            panels.forEach(p => p.classList.remove('show'));
            tabs.forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('show');
            evt.currentTarget.classList.add('active');
        }

        // 오늘 날짜를 기본값으로 설정하는 스크립트 (선택사항)
        document.querySelectorAll('input[type="date"]').forEach(el => {
            if(!el.value) {
                const today = new Date();
                today.setDate(today.getDate() + 7); // 기본 7일 뒤로 설정
                el.value = today.toISOString().substr(0, 10);
            }
        });
    </script>
</body>
</html>