{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/my_django.css' %}">
    <title>재료 선택</title>
    <style>
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 20px;
            margin: 5px auto;
            width: fit-content;
            padding: 2px 8px;
        }
        .qty-btn {
            background: none;
            border: none;
            color: #ff6b6b;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            padding: 0 8px;
        }
        .qty-number {
            font-size: 14px;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        .submit-add-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 15px;
            font-size: 12px;
            margin-top: 8px;
            cursor: pointer;
            width: 80%;
        }
    </style>
</head>
<body class="select-page">
    <div class="container">
        <header class="select-header" style="display: flex; align-items: center; padding-bottom: 10px; border-bottom: 1px solid #eee;">
            <a href="{% url 'my_django:fridge_main' %}" class="close-btn" style="font-size: 24px; text-decoration: none; color: #333;">✕</a>
            <h2 style="margin-left: 15px; font-size: 18px;">재료 선택</h2>
        </header>

        <div class="category-scroll-wrapper">
            {% for category in organized_data.keys %}
                <div class="category-tab {% if forloop.first %}active{% endif %}" 
                     onclick="openTab(event, 'tab-{{ forloop.counter }}')">
                    {{ category }}
                </div>
            {% endfor %}
        </div>

        <div class="ingredient-content">
            {% for category, items in organized_data.items %}
                <div id="tab-{{ forloop.counter }}" class="ingredient-panel {% if forloop.first %}show{% endif %}">
                    <div class="ingredient-grid">
                        {% for item in items %}
                            <div class="card" style="padding-bottom: 15px;"> 
                            <!-- <div class="card">  -->
                                <form action="{% url 'my_django:add_ingredient' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="name" value="{{ item.name }}">
                                    <input type="hidden" name="category" value="{{ category }}">
                                    
                                    <div class="image-box" style="height: 50px; display: flex; align-items: center; justify-content: center;">
                                        <img src="{% static 'images/' %}{{ item.name }}.png" 
                                             alt="{{ item.name }}" 
                                             class="ingredient-img"
                                             style="width: 45px; height: 45px; object-fit: contain;">
                                    </div>
                                    
                                    <span class="ingredient-name" style="display: block; margin: 8px 0; font-size: 14px;">
                                        {{ item.name }}
                                    </span>

                                    <div class="quantity-selector">
                                        <button type="button" class="qty-btn" onclick="adjustQty(this, -1)">-</button>
                                        <input type="hidden" name="quantity" value="1" class="qty-input">
                                        <span class="qty-number">1</span>
                                        <button type="button" class="qty-btn" onclick="adjustQty(this, 1)">+</button>
                                    </div>
                                    
                                    <button type="submit" class="submit-add-btn">추가하기</button>
                                    <!-- <span class="ingredient-name" style="display: block; margin: 5px 0; font-size: 14px; font-weight: bold;">{{ item }}</span>
                                    
                                    <div class="input-group" style="margin-bottom: 10px;">
                                        <input type="number" name="quantity" value="1" min="1" 
                                               style="width: 40px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;">
                                        <span style="font-size: 11px;">개</span>
                                    </div>
                                    
                                    <input type="date" name="expiry_date" 
                                           style="width: 90%; font-size: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px;">

                                    <button type="submit" class="add-badge" 
                                            style="background: #ff6b6b; color: white; border: none; border-radius: 20px; width: 80%; height: 25px; cursor: pointer; font-size: 12px;">
                                        추가 +
                                    </button> -->
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function openTab(evt, tabId) {
            const panels = document.querySelectorAll('.ingredient-panel');
            const tabs = document.querySelectorAll('.category-tab');
            panels.forEach(p => p.classList.remove('show'));
            tabs.forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('show');
            evt.currentTarget.classList.add('active');
        }

        function adjustQty(btn, change) {
            const container = btn.parentElement;
            const input = container.querySelector('.qty-input');
            const display = container.querySelector('.qty-number');
            
            let currentVal = parseInt(input.value);
            let newVal = currentVal + change;
            
            if (newVal < 1) newVal = 1; 
            
            input.value = newVal;
            display.innerText = newVal;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('.ingredient-img');
            const defaultImage = "{% static 'images/default.png' %}";
            images.forEach(img => {
                img.addEventListener('error', function() {
                    this.src = defaultImage;
                });
            });
        // // 오늘 날짜를 기본값으로 설정하는 스크립트 (선택사항)
        // document.querySelectorAll('input[type="date"]').forEach(el => {
        //     if(!el.value) {
        //         const today = new Date();
        //         today.setDate(today.getDate() + 7); // 기본 7일 뒤로 설정
        //         el.value = today.toISOString().substr(0, 10);
        //     }
        });
    </script>
</body>
</html>